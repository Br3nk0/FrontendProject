function initCanvas(e,t){if(e===undefined||!(e instanceof Number)){e=Canvas_Width}if(t===undefined||!(t instanceof Number)){t=Canvas_Height}ctx.fillStyle="black";ctx.fillRect(0,0,Canvas_Width,Canvas_Height)}function initMaze(){for(var e=0;e<maze.length;e++){var t=new Array(Canvas_Width/Grid_Width);maze[e]=t}for(var n=0;n<Canvas_Height/Grid_Height;n++){for(var r=0;r<Canvas_Width/Grid_Width;r++){var i=Normal_Bean;var s=new Grid(r*Grid_Width,n*Grid_Height,mazeContent[n][r],i);maze[n][r]=s;s.draw()}}for(var e=0;e<noBean.length;e++){var o=noBean[e][0];var u=noBean[e][1];maze[o][u].beanType=undefined;maze[o][u].draw()}for(var e=0;e<powerBeans.length;e++){var o=powerBeans[e][0];var u=powerBeans[e][1];maze[o][u].beanType=Power_Bean;maze[o][u].draw()}}function initFields(){for(var e=9;e<13;e++){ghostHouse[ghostHouseIndex]=[e,9];ghostHouseIndex++}for(var e=0;e<2;e++){for(var t=8;t<17;t++){staticGrids[staticGridsIndex]=[e,t];staticGridsIndex++}}for(var e=9;e<17;e++){for(var t=0;t<4;t++){staticGrids[staticGridsIndex]=[e,t];staticGridsIndex++}}for(var e=2;e<6;e++){for(var t=14;t<17;t++){staticGrids[staticGridsIndex]=[e,t];staticGridsIndex++}}for(var e=0;e<2;e++){for(var t=8;t<17;t++){noBean[noBeanIndex]=[e,t];noBeanIndex++}}for(var e=2;e<6;e++){for(var t=14;t<17;t++){noBean[noBeanIndex]=[e,t];noBeanIndex++}}for(var e=9;e<17;e++){for(var t=0;t<4;t++){noBean[noBeanIndex]=[e,t];noBeanIndex++}}for(var e=6;e<8;e++){for(var t=2;t<5;t++){noBean[noBeanIndex]=[e,t];noBeanIndex++}}for(var e=14;e<16;e++){for(var t=8;t<10;t++){noBean[noBeanIndex]=[e,t];noBeanIndex++}}for(var e=1;e<5;e++){noBean[noBeanIndex]=[e,1];noBeanIndex++}for(var e=1;e<5;e++){noBean[noBeanIndex]=[e,4];noBeanIndex++}for(var e=3;e<7;e++){noBean[noBeanIndex]=[e,6];noBeanIndex++}for(var e=3;e<7;e++){noBean[noBeanIndex]=[e,12];noBeanIndex++}for(var e=6;e<8;e++){noBean[noBeanIndex]=[e,0];noBeanIndex++}for(var e=8;e<11;e++){noBean[noBeanIndex]=[e,6];noBeanIndex++}for(var e=8;e<13;e++){noBean[noBeanIndex]=[e,8];noBeanIndex++}for(var e=8;e<13;e++){noBean[noBeanIndex]=[e,10];noBeanIndex++}for(var e=12;e<16;e++){noBean[noBeanIndex]=[e,5];noBeanIndex++}for(var e=14;e<16;e++){noBean[noBeanIndex]=[e,6];noBeanIndex++}for(var e=9;e<11;e++){noBean[noBeanIndex]=[e,4];noBeanIndex++}for(var e=13;e<16;e++){noBean[noBeanIndex]=[e,15];noBeanIndex++}for(var e=9;e<12;e++){noBean[noBeanIndex]=[e,12];noBeanIndex++}for(var t=11;t<14;t++){noBean[noBeanIndex]=[16,t];noBeanIndex++}for(var t=11;t<15;t++){noBean[noBeanIndex]=[14,t];noBeanIndex++}for(var t=12;t<16;t++){noBean[noBeanIndex]=[8,t];noBeanIndex++}for(var t=12;t<16;t++){noBean[noBeanIndex]=[11,t];noBeanIndex++}for(var t=12;t<14;t++){noBean[noBeanIndex]=[12,t];noBeanIndex++}}function circle(e,t,n,r){e.beginPath();e.arc(t,n,r,0,2*Math.PI,true);e.fill()}function oppositeDir(e){switch(e){case Up:return Down;break;case Down:return Up;break;case Left:return Right;break;case Right:return Left;break;default:return-1}}function getRowIndex(e){if(e===undefined){return-1}return parseInt(e/Grid_Height)}function getColIndex(e){if(e===undefined){return-1}return parseInt(e/Grid_Width)}function sleep(e){var t=new Date;t.setTime(t.getTime()+e);while((new Date).getTime()<t.getTime());}function fixGrids(e,t){var n=getRowIndex(t);var r=getColIndex(e);if(xOnGridCenter(t)){maze[n][r].draw();if(r+1<maze.length&&!staticArrayContains([n,r+1])){maze[n][r+1].draw()}if(r-1>=0&&!staticArrayContains([n,r-1])){maze[n][r-1].draw()}}else if(yOnGridCenter(e)){maze[n][r].draw();if(n+1<maze.length&&!staticArrayContains([n+1,r])){maze[n+1][r].draw()}if(n-1>=0&&!staticArrayContains([n-1,r])){maze[n-1][r].draw()}}}function staticArrayContains(e){var t=e[0];var n=e[1];for(var r=0;r<staticGrids.length;r++){if(t===staticGrids[r][0]&&n===staticGrids[r][1]){return true}}return false}function ghostHouseContains(e){var t=e[0];var n=e[1];for(var r=0;r<ghostHouse.length;r++){if(t===ghostHouse[r][0]&&n===ghostHouse[r][1]){return true}}return false}function onGridCenter(e,t){return xOnGridCenter(t)&&yOnGridCenter(e)}function xOnGridCenter(e){return(e-Grid_Width/2)%Grid_Width===0}function yOnGridCenter(e){return(e-Grid_Height/2)%Grid_Height===0}function canMove(e,t,n){if(!onGridCenter(e,t)){return true}var r=false;var i=maze[getRowIndex(t)][getColIndex(e)];var s=i.gridType;switch(n){case Up:if(s!=Left_Top&&s!=Right_Top&&s!=Top_Bottom&&s!=Top_Only&&s!=Left_Top_Right&&s!=Top_Right_Bottom&&s!=Bottom_Left_Top){r=true}break;case Down:if(s!=Left_Bottom&&s!=Top_Bottom&&s!=Right_Bottom&&s!=Bottom_Only&&s!=Right_Bottom_Left&&s!=Bottom_Left_Top&&s!=Top_Right_Bottom){r=true}break;case Left:if(s!=Left_Bottom&&s!=Left_Top&&s!=Left_Only&&s!=Left_Right&&s!=Left_Top_Right&&s!=Bottom_Left_Top&&s!=Right_Bottom_Left){r=true}break;case Right:if(s!=Right_Bottom&&s!=Right_Top&&s!=Right_Only&&s!=Left_Right&&s!=Right_Bottom_Left&&s!=Top_Right_Bottom&&s!=Left_Top_Right){r=true}break;default:break}return r}function printInstruction(){ctx.fillStyle="white";ctx.font="12px monospace";ctx.textAlign="left";var e="WELCOME TO \nPACMAN!\n\n\nQZSD to move\n\nP to pause\nE to resume\nR to restart";var t=12;var n=Canvas_Height-200;var r=15;var i=e.split("\n");for(var s=0;s<i.length;s++)ctx.fillText(i[s],t,n+s*r);if(ghosts.length===0){ctx.fillStyle="black";ctx.fillRect(t,Canvas_Width-40,70,30);ctx.fillStyle="red";ctx.font="16px monospace";ctx.textAlign="left";ctx.fillText("GOD MODE",t,Canvas_Width-20)}}function showLives(){ctx.fillStyle="black";ctx.fillRect(Canvas_Width-80,10,70,30);for(var e=0;e<life-1;e++){lives[e]=new Pacman(Canvas_Width-50+25*e,30,Right);lives[e].draw()}}function welcomeScreen(){gameOn=false;gamePaused=false;ctx.fillStyle="white";ctx.font="80px monospace";ctx.textAlign="center";ctx.fillText("PACMAN",Canvas_Width/2,170);ctx.font="20px monospace";ctx.fillText("Press s to start",Canvas_Width/2,220);welcomePacman=new Pacman(Canvas_Width/5,Canvas_Height/3*2,Right);welcomePacman.radius=30;welcomePacman.draw();welcomeBlinky=new Ghost(Canvas_Width/5*3.3,Canvas_Height/3*2,Red,Left);welcomeBlinky.radius=30;welcomeBlinky.draw();welcomeInky=new Ghost(Canvas_Width/5*4,Canvas_Height/3*2,Cyan,Right);welcomeInky.radius=30;welcomeInky.draw();Interval=setInterval(updateWelcomeScreen,timerDelay*2)}function updateWelcomeScreen(){ctx.fillStyle="black";ctx.fillRect(0,Canvas_Height/2,Canvas_Width,140);welcomePacman.mouthOpen=!welcomePacman.mouthOpen;welcomeBlinky.isMoving=!welcomeBlinky.isMoving;welcomeInky.isMoving=!welcomeInky.isMoving;welcomePacman.draw();welcomeInky.draw();welcomeBlinky.draw()}function showScore(){ctx.fillStyle="black";ctx.fillRect(Canvas_Width-250,10,190,40);ctx.fillStyle="white";ctx.font="24px monospace";ctx.textAlign="left";ctx.fillText("score: "+parseInt(score),Canvas_Width-250,37)}function winMessage(){ctx.fillStyle="black";ctx.strokeStyle="green";ctx.lineWidth=5;ctx.fillRect(Canvas_Width/2-150,Canvas_Height/2-40,300,100);ctx.strokeRect(Canvas_Width/2-150,Canvas_Height/2-40,300,100);ctx.textAlign="center";ctx.fillStyle="white";ctx.font="16px monospace";ctx.fillText("Congratulations, you won!",Canvas_Height/2,Canvas_Height/2+6);ctx.font="12px monospace";ctx.fillText("press R to play again",Canvas_Height/2,Canvas_Height/2+28)}function loseMessage(){ctx.fillStyle="black";ctx.strokeStyle="red";ctx.lineWidth=5;ctx.fillRect(Canvas_Width/2-100,Canvas_Height/2-40,200,100);ctx.strokeRect(Canvas_Width/2-100,Canvas_Height/2-40,200,100);ctx.textAlign="center";ctx.fillStyle="red";ctx.font="26px monospace";ctx.fillText("GAME OVER",Canvas_Height/2,Canvas_Height/2+7);ctx.font="12px monospace";ctx.fillText("press R to play again",Canvas_Height/2,Canvas_Height/2+28)}function updateCanvas(){restartTimer++;if(gameOver()===true){life--;showLives();if(life>0){sleep(500);clearInterval(Interval);fixGrids(mrPacman.x,mrPacman.y);for(var e=0;e<ghosts.length;e++){fixGrids(ghosts[e].x,ghosts[e].y)}run()}else{clearInterval(Interval);sleep(500);loseMessage()}}else if(pacmanWon()===true){clearInterval(Interval);sleep(500);winMessage()}else{if(weakCounter>0&&weakCounter<2e3/timerDelay){for(var e=0;e<ghosts.length;e++){ghosts[e].isBlinking=!ghosts[e].isBlinking}}if(weakCounter>0){weakCounter--}if(weakCounter===0){for(var e=0;e<ghosts.length;e++){ghosts[e].isDead=false;ghosts[e].isWeak=false;ghosts[e.isBlinking=false];weakBonus=200}}eatBean();eatGhost();mrPacman.move();for(var e=0;e<ghosts.length;e++){if(ghosts[e].isDead===false){ghosts[e].move()}}fixGrids(mrPacman.x,mrPacman.y);for(var e=0;e<ghosts.length;e++){fixGrids(ghosts[e].x,ghosts[e].y)}mrPacman.draw();for(var e=0;e<ghosts.length;e++){ghosts[e].draw()}}}function eatBean(){if(onGridCenter(mrPacman.x,mrPacman.y)){if(maze[mrPacman.getRow()][mrPacman.getCol()].beanType===Normal_Bean){score+=parseInt(10);showScore();beansLeft--}else if(maze[mrPacman.getRow()][mrPacman.getCol()].beanType===Power_Bean){score+=parseInt(50);showScore();beansLeft--;for(var e=0;e<ghosts.length;e++){ghosts[e].isWeak=true}weakCounter=Weak_Duration}maze[mrPacman.getRow()][mrPacman.getCol()].beanType=undefined;maze[mrPacman.getRow()][mrPacman.getCol()].draw()}}function eatGhost(){for(var e=0;e<ghosts.length;e++){if(Math.abs(mrPacman.x-ghosts[e].x)<=5&&Math.abs(mrPacman.y-ghosts[e].y)<=5&&ghosts[e].isWeak&&!ghosts[e].isDead){score+=parseInt(weakBonus);weakBonus*=2;showScore();ghosts[e].isDead=true;ghosts[e].toGhostHouse()}}}function gameOver(){for(var e=0;e<ghosts.length;e++){if(Math.abs(mrPacman.x-ghosts[e].x)<=5&&Math.abs(mrPacman.y-ghosts[e].y)<=5&&!ghosts[e].isWeak){return true}}return false}function pacmanWon(){return beansLeft===0}function countDown(){ctx.fillStyle="black";ctx.fillRect(Canvas_Height-85,70,80,80);ctx.fillStyle="red";ctx.font="50px monospace";ctx.textAlign="center";ctx.fillText("3",Canvas_Height-43,130);setTimeout(function(){ctx.fillStyle="black";ctx.fillRect(Canvas_Height-85,70,80,80);ctx.fillStyle="orange";ctx.fillText("2",Canvas_Height-43,130);setTimeout(function(){ctx.fillStyle="black";ctx.fillRect(Canvas_Height-85,70,80,80);ctx.fillStyle="yellow";ctx.fillText("1",Canvas_Height-43,130);setTimeout(function(){ctx.fillStyle="black";ctx.fillRect(Canvas_Height-85,70,80,80);ctx.fillStyle="green";ctx.textAlign="center";ctx.fillText("GO",Canvas_Height-43,130);setTimeout(function(){Interval=setInterval(updateCanvas,timerDelay)},500)},1e3)},1e3)},1e3)}function onKeyDown(e){var t=e.keyCode;var n=80;var r=69;var i=82;var s=71;var o=90;var u=81;var a=83;var f=68;if(!gameOn){if(t===a){clearInterval(Interval);gameOn=true;gamePaused=false;initMaze();run();return}else if(t===s){clearInterval(Interval);ghosts=[];gameOn=true;gamePaused=false;initMaze();run(true);return}}else{if(t===n&&!gamePaused){clearInterval(Interval);gamePaused=true;return}if(t===r&&gamePaused){Interval=setInterval(updateCanvas,timerDelay);gamePaused=false;return}if(t===i&&restartTimer>0){restartTimer=0;clearInterval(Interval);gameOn=true;gamePaused=false;score=0;life=Max_Life;beansLeft=Max_Beans;initMaze();run()}switch(t){case o:mrPacman.nextDir=mrPacman.dir===Up?undefined:Up;break;case f:mrPacman.nextDir=mrPacman.dir===Right?undefined:Right;break;case u:mrPacman.nextDir=mrPacman.dir===Left?undefined:Left;break;case a:mrPacman.nextDir=mrPacman.dir===Down?undefined:Down;break;default:break}}}function run(e){showScore();mrPacman=new Pacman(pacmanStartLoc[1]*Grid_Width+Grid_Width/2,pacmanStartLoc[0]*Grid_Height+Grid_Height/2,Right);if(e===undefined||!e){blinky=new Ghost(0,0,Red,Down);inky=new Ghost(0,0,Cyan,Down);pinky=new Ghost(0,0,Pink,Down);clyde=new Ghost(0,0,Orange,Down);blinky.toGhostHouse();inky.toGhostHouse();pinky.toGhostHouse();clyde.toGhostHouse();ghosts=[blinky,inky,pinky,clyde];inky.draw();blinky.draw();pinky.draw();clyde.draw()}else{ghosts=[]}showLives();printInstruction();mrPacman.draw();countDown()}var canvasID="myCanvas";var Canvas_Width=510;var Canvas_Height=510;var canvas=document.getElementById(canvasID);var ctx=canvas.getContext("2d");var Grid_Width=30;var Grid_Height=30;var Wall_Width=3;var numRows=Canvas_Width/Grid_Height;var numCols=Canvas_Height/Grid_Width;var Bg_Color="black";var Border_Color="blue";var Bean_Color="white";var Pacman_Color="yellow";var Red="red";var Pink="#ff9cce";var Cyan="#00ffde";var Orange="#ffb847";var Weak_Color="#0031ff";var Blinking_Color="white";var Normal_Bean_Radius=2;var Power_Bean_Radius=5;var Pacman_Radius=9;var Ghost_Radius=9;var Up=1;var Down=2;var Left=3;var Right=4;var Interval;var restartTimer=0;var timerDelay=80;var speed=5;var score=0;var lives=[];var Max_Life=3;var life=Max_Life;var weakBonus=200;var Max_Beans=136;var beansLeft=Max_Beans;var weakCounter;var Weak_Duration=1e4/timerDelay;var Normal_Bean=1;var Power_Bean=2;var welcomePacman;var welcomeBlinky;var welcomeInky;var mrPacman;var blinky;var inky;var pinky;var clyde;var ghosts;var gameOn=false;var gamePaused=false;var maze=new Array(Canvas_Height/Grid_Height);var mazeContent=[[Left_Top,Top_Bottom,Top_Only,Top_Only,Top_Bottom,Top_Only,Top_Bottom,Right_Top,Left_Top,Top_Only,Top_Only,Top_Only,Top_Only,Top_Only,Top_Only,Top_Only,Right_Top],[Left_Right,Left_Top_Right,Left_Bottom,Right_Only,Left_Top_Right,Left_Right,Closed_Grid,Left_Right,Left_Bottom,Bottom_Only,Bottom_Only,Bottom_Only,Bottom_Only,Bottom_Only,Empty_Grid,Empty_Grid,Right_Only],[Left_Right,Left_Only,Top_Right_Bottom,Right_Bottom_Left,Left_Right,Left_Only,Top_Bottom,Empty_Grid,Top_Only,Top_Bottom,Top_Only,Top_Only,Top_Bottom,Right_Top,Left_Only,Empty_Grid,Right_Only],[Left_Right,Left_Right,Left_Top_Right,Bottom_Left_Top,Right_Only,Left_Right,Left_Top_Right,Left_Bottom,Right_Only,Closed_Grid,Left_Only,Right_Bottom,Left_Top_Right,Left_Right,Left_Only,Empty_Grid,Right_Only],[Left_Right,Right_Bottom_Left,Left_Only,Right_Top,Right_Bottom_Left,Left_Right,Left_Only,Top_Right_Bottom,Left_Bottom,Top_Only,Right_Bottom,Bottom_Left_Top,Right_Only,Left_Right,Left_Only,Empty_Grid,Right_Only],[Left_Bottom,Top_Only,Bottom_Only,Bottom_Only,Top_Bottom,Right_Only,Left_Right,Left_Top_Right,Closed_Grid,Right_Bottom_Left,Closed_Grid,Left_Top_Right,Left_Right,Left_Right,Left_Bottom,Bottom_Only,Right_Bottom],[Left_Top_Right,Left_Right,Left_Top,Top_Only,Right_Top,Left_Right,Right_Bottom_Left,Left_Only,Right_Top,Closed_Grid,Left_Top,Right_Only,Right_Bottom_Left,Left_Only,Right_Top,Closed_Grid,Left_Top_Right],[Right_Bottom_Left,Left_Right,Left_Bottom,Bottom_Only,Right_Bottom,Left_Only,Top_Bottom,Empty_Grid,Bottom_Only,Top_Bottom,Bottom_Only,Empty_Grid,Top_Bottom,Bottom_Only,Bottom_Only,Top_Bottom,Right_Only],[Bottom_Left_Top,Bottom_Only,Top_Bottom,Top_Bottom,Top_Bottom,Right_Only,Left_Top_Right,Left_Right,Left_Top,Top_Bottom,Right_Top,Left_Right,Left_Top,Top_Bottom,Top_Bottom,Top_Right_Bottom,Left_Right],[Left_Top,Top_Only,Top_Only,Right_Top,Left_Top_Right,Left_Right,Left_Right,Left_Right,Left_Right,Left_Top_Right,Left_Right,Left_Right,Left_Right,Left_Top,Top_Only,Top_Only,Right_Only],[Left_Only,Empty_Grid,Empty_Grid,Right_Only,Right_Bottom_Left,Left_Right,Right_Bottom_Left,Left_Right,Left_Right,Left_Right,Left_Right,Left_Right,Left_Right,Left_Bottom,Bottom_Only,Bottom_Only,Right_Only],[Left_Only,Empty_Grid,Empty_Grid,Right_Only,Left_Top,Bottom_Only,Top_Only,Right_Bottom,Left_Right,Left_Right,Left_Right,Left_Right,Left_Only,Top_Only,Top_Bottom,Top_Right_Bottom,Left_Right],[Left_Only,Empty_Grid,Empty_Grid,Right_Only,Left_Right,Left_Top_Right,Left_Right,Bottom_Left_Top,Right_Bottom,Left_Right,Right_Bottom_Left,Left_Right,Left_Bottom,Right_Bottom,Left_Top,Top_Bottom,Right_Only],[Left_Only,Empty_Grid,Empty_Grid,Right_Only,Left_Right,Left_Right,Left_Bottom,Top_Only,Top_Bottom,Bottom_Only,Top_Only,Bottom_Only,Top_Bottom,Top_Bottom,Right_Bottom,Left_Top_Right,Left_Right],[Left_Only,Empty_Grid,Empty_Grid,Right_Only,Left_Right,Left_Only,Right_Top,Left_Right,Left_Top,Right_Top,Left_Right,Bottom_Left_Top,Top_Bottom,Top_Bottom,Top_Bottom,Right_Only,Left_Right],[Left_Only,Empty_Grid,Empty_Grid,Right_Only,Left_Right,Left_Bottom,Right_Bottom,Left_Right,Left_Bottom,Right_Bottom,Left_Only,Top_Bottom,Top_Bottom,Top_Bottom,Right_Top,Right_Bottom_Left,Left_Right],[Left_Bottom,Bottom_Only,Bottom_Only,Right_Bottom,Left_Bottom,Top_Bottom,Top_Bottom,Bottom_Only,Top_Bottom,Top_Bottom,Right_Bottom,Bottom_Left_Top,Top_Bottom,Top_Right_Bottom,Left_Bottom,Top_Bottom,Right_Bottom]];var staticGrids=[];var staticGridsIndex=0;var pacmanStartLoc=[4,9];var noBean=[pacmanStartLoc,[2,2],[3,3],[8,9],[1,6],[4,7],[5,8],[6,9],[5,10],[4,11],[3,9],[12,7],[6,15]];var noBeanIndex=noBean.length;var powerBeans=[[0,0],[2,13],[16,4],[16,16],[7,9],[2,5],[14,10]];var ghostHouse=[];var ghostHouseIndex=0;initFields();initCanvas(Canvas_Width,Canvas_Height);canvas.addEventListener("keydown",onKeyDown,false);canvas.setAttribute("tabindex","0");canvas.focus();welcomeScreen()